<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IT Equipment Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    h2 {
      margin-top: 40px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
    input, select, button {
      padding: 6px;
      margin: 5px;
    }
  </style>
</head>
<body>

  <h1>IT Equipment Service</h1>

  <h2>üéØ All Equipment</h2>
  <button onclick="loadAllEquipment()">Load All</button>
  <button onclick="loadAvailable()">Show Available Only</button>
  <table id="equipmentTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Type</th>
        <th>Available</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- <h2>‚ûï Add New Equipment</h2>
  <input type="text" id="nameInput" placeholder="Name">
  <input type="text" id="typeInput" placeholder="Type">
  <button onclick="addEquipment()">Add</button> -->

  <h2>üì¶ Borrow Equipment</h2>
  <input type="number" id="borrowEmployeeId" placeholder="Employee ID">
  <input type="number" id="borrowEquipmentId" placeholder="Equipment ID">
  <button onclick="borrowEquipment()">Borrow</button>

  <!-- <h2>üì§ Return Equipment</h2>
  <input type="number" id="returnBorrowId" placeholder="Borrow ID">
  <button onclick="returnEquipment()">Return</button> -->

  <h2>üßæ View Borrow Records</h2>
  <input type="number" id="searchEmployeeId" placeholder="Employee ID">
  <button onclick="getBorrowRecords()">Search</button>
  <button onclick="getAllBorrowRecords()">Search All</button>
  <table id="borrowTable">
    <thead>
      <tr>
        <th>Borrow ID</th>
        <th>Equipment Name</th>
        <th>Borrow Date</th>
        <th>Return Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API = "http://localhost:8081";

    async function loadAllEquipment() {
      const res = await fetch(`${API}/equipment`);
      const data = await res.json();
      displayEquipment(data);
    }

    async function loadAvailable() {
      const res = await fetch(`${API}/equipment/available`);
      const data = await res.json();
      displayEquipment(data);
    }

    function displayEquipment(data) {
        const tbody = document.querySelector("#equipmentTable tbody");
        tbody.innerHTML = "";
        data.forEach(e => {
            tbody.innerHTML += `<tr>
            <td>${e.id}</td>
            <td>${e.name}</td>
            <td>${e.type}</td>
            <td>${e.available ? "‚úÖ" : "‚ùå"}</td>
            </tr>`;
        });
        }

    async function addEquipment() {
        const name = document.getElementById("nameInput").value;
        const type = document.getElementById("typeInput").value;
        const res = await fetch(`${API}/equipment`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, type, available: true })
        });
        const data = await res.json();
        alert("Added equipment: " + data.name);
        loadAllEquipment();
        }

    async function borrowEquipment() {
        const employeeId = document.getElementById("borrowEmployeeId").value;
        const equipmentId = document.getElementById("borrowEquipmentId").value;
        const res = await fetch(`${API}/borrow?employeeId=${employeeId}&equipmentId=${equipmentId}`, {
            method: "POST"
        });
        if (res.ok) {
            const data = await res.json();
            alert("Borrowed successfully, borrow ID: " + data.id);
            loadAllEquipment();
        } else {
            alert("Failed to borrow. " + await res.text());
        }
        }

    async function returnEquipment(borrowId) {
        <!-- const borrowId = document.getElementById("returnBorrowId").value; -->
        const res = await fetch(`${API}/borrow/return?borrowId=${borrowId}`, {
            method: "POST"
        });
        if (res.ok) {
            const data = await res.json();
            alert("Returned successfully.");
            loadAllEquipment();
            getAllBorrowRecords();
        } else {
            alert("Return failed. " + await res.text());
        }

    }

    /*async function getBorrowRecords() {
        const employeeId = document.getElementById("searchEmployeeId").value;
        const res = await fetch(`${API}/borrow/employee/${employeeId}`);
        const data = await res.json();
        const tbody = document.querySelector("#borrowTable tbody");
        tbody.innerHTML = "";
        data.forEach(r => {
            tbody.innerHTML += `<tr>
            <td>${r.id}</td>
            <td>${r.equipment.name}</td>
            <td>${r.borrowDate}</td>
            <td>${r.returnDate || "-"}</td>
            <td>${r.returned ? "‚úÖ Returned" : "‚ùå Not Returned"}</td>
            </tr>`;
        });
        }*/

    async function getBorrowRecords() {
            const employeeId = document.getElementById("searchEmployeeId").value;
            const res = await fetch(`${API}/borrow/employee/${employeeId}`);
            const data = await res.json();
            const tbody = document.querySelector("#borrowTable tbody");
            tbody.innerHTML = "";
        
            data.forEach(r => {
            const returnButton = !r.returned
                ? `<button onclick="returnEquipment(${r.id})">Return</button>`
                : "";
        
            tbody.innerHTML += `<tr>
                <td>${r.id}</td>
                <td>${r.equipment.name}</td>
                <td>${r.borrowDate}</td>
                <td>${r.returnDate || "-"}</td>
                <td>${r.returned ? "‚úÖ Returned" : "‚ùå Not Returned"} ${returnButton}</td>
            </tr>`;
            });
        }

        async function getAllBorrowRecords() {
            const employeeId = document.getElementById("searchEmployeeId").value;
            const res = await fetch(`${API}/borrow/all`);
            const data = await res.json();
            const tbody = document.querySelector("#borrowTable tbody");
            tbody.innerHTML = "";
        
            data.forEach(r => {
            const returnButton = !r.returned
                ? `<button onclick="returnEquipment(${r.id})">Return</button>`
                : "";
        
            tbody.innerHTML += `<tr>
                <td>${r.id}</td>
                <td>${r.equipment.name}</td>
                <td>${r.borrowDate}</td>
                <td>${r.returnDate || "-"}</td>
                <td>${r.returned ? "‚úÖ Returned" : "‚ùå Not Returned"} ${returnButton}</td>
            </tr>`;
            });
        }


    </script>
</body>
</html>
